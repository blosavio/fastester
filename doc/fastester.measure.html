<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>fastester.measure documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Fastester</span> <span class="project-version">version 0</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1"><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>fastester</span></div></div></li><li class="depth-2 branch"><a href="fastester.core.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-2 branch"><a href="fastester.display.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>display</span></div></a></li><li class="depth-2 current"><a href="fastester.measure.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>measure</span></div></a></li></ul><ul class="index-link"><li class="depth-1"><a href="https://github.com/blosavio/fastester">Project home</a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="fastester.measure.html#var-*lightning-benchmark-opts*"><div class="inner"><span>*lightning-benchmark-opts*</span></div></a></li><li class="depth-1"><a href="fastester.measure.html#var-benchmark-fn"><div class="inner"><span>benchmark-fn</span></div></a></li><li class="depth-1"><a href="fastester.measure.html#var-clear-registry.21"><div class="inner"><span>clear-registry!</span></div></a></li><li class="depth-1"><a href="fastester.measure.html#var-defbench"><div class="inner"><span>defbench</span></div></a></li><li class="depth-1"><a href="fastester.measure.html#var-defbench*"><div class="inner"><span>defbench*</span></div></a></li><li class="depth-1"><a href="fastester.measure.html#var-range-pow-10"><div class="inner"><span>range-pow-10</span></div></a></li><li class="depth-1"><a href="fastester.measure.html#var-range-pow-2"><div class="inner"><span>range-pow-2</span></div></a></li><li class="depth-1"><a href="fastester.measure.html#var-registry"><div class="inner"><span>registry</span></div></a></li><li class="depth-1"><a href="fastester.measure.html#var-run-benchmarks"><div class="inner"><span>run-benchmarks</span></div></a></li><li class="depth-1"><a href="fastester.measure.html#var-run-manual-benchmark"><div class="inner"><span>run-manual-benchmark</span></div></a></li><li class="depth-1"><a href="fastester.measure.html#var-run-one-defined-benchmark"><div class="inner"><span>run-one-defined-benchmark</span></div></a></li><li class="depth-1"><a href="fastester.measure.html#var-run-one-defined-benchmark*"><div class="inner"><span>run-one-defined-benchmark*</span></div></a></li><li class="depth-1"><a href="fastester.measure.html#var-run-save-benchmark"><div class="inner"><span>run-save-benchmark</span></div></a></li><li class="depth-1"><a href="fastester.measure.html#var-undefbench"><div class="inner"><span>undefbench</span></div></a></li><li class="depth-1"><a href="fastester.measure.html#var-undefbench*"><div class="inner"><span>undefbench*</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">fastester.measure</h1><div class="doc"><div class="markdown"><p>Define and run benchmarks that objectively measure a function’s evaluation time.</p>
<p>The general idea is to run the benchmark suite once per release. Any performance improvement/regression is objectively measured and included in the changelog/release notes.</p>
<p>The <a href="https://github.com/hugoduncan/criterium/">Criterium</a> library does all the actual performance measurements.</p>
<p>See <a href="fastester.display.html">fastester.display</a> for utilities that generate an html document with charts and tables that communicate those results.</p>
<p>Functions that consume symbols for the purposes of binding a name (<a href="fastester.measure.html#var-defbench">defbench</a> and <a href="fastester.measure.html#var-defbench*">defbench*</a>) may be either simple or qualified. Qualified symbols are used as-is to bind the name. Simple symbols are automatically prepended with <code>*ns*</code> before used to bind the name.</p>
<p>Functions that consume symbols for the purposes of name lookup (<a href="fastester.measure.html#var-undefbench">undefbench</a>, <a href="fastester.measure.html#var-undefbench*">undefbench*</a>, <a href="fastester.measure.html#var-benchmark-fn">benchmark-fn</a>, and <a href="fastester.measure.html#var-run-one-defined-benchmark">run-one-defined-benchmark</a>) may be either simple or qualified. Qualified symbols are used as-is for the lookup. If a simple symbol is used for lookup, there must be only one qualified name with given simple part, otherwise an exception is thrown.</p>
<p>Simple symbols are intended as a dev-time convenience. Use explicit, qualified symbols when running (i.e., <code>:benchmarks</code> section of the options hashmap).</p>
</div></div><div class="public anchor" id="var-*lightning-benchmark-opts*"><h3>*lightning-benchmark-opts*</h3><h4 class="dynamic">dynamic</h4><div class="usage"></div><div class="doc"><div class="markdown"><p>Criterium options with extremely minimal samples, etc. Use only for quick, proof-of-concept runs.</p>
<p>Example:</p>
<pre><code class="language-clojure">  (criterium.core/benchmark (+ 1 2) *lightning-benchmark-opts*)
</code></pre>
<p>See also <a href="https://github.com/hugoduncan/criterium/blob/bb10582ded6de31b4b985dc31d501db604c0e461/src/criterium/core.clj#L83"><code>criterium.core/*default-benchmark-opts*</code></a> and <a href="https://github.com/hugoduncan/criterium/blob/bb10582ded6de31b4b985dc31d501db604c0e461/src/criterium/core.clj#L92"><code>criterium.core/*default-quick-bench-opts*</code></a>.</p>
</div></div><div class="src-link"><a href="https://github.com/blosavio/fastester/blob/main/src/fastester/measure.clj#L332">view source</a></div></div><div class="public anchor" id="var-benchmark-fn"><h3>benchmark-fn</h3><h4 class="type">macro</h4><div class="usage"><code>(benchmark-fn benchmark-name)</code></div><div class="doc"><div class="markdown"><p>Given symbol <code>benchmark-name</code>, returns the benchmark definition’s function object.</p>
<p>Example:</p>
<pre><code class="language-clojure">(defbench foo-qualifier/baz-name "quz group" (fn [z] (+ z z)) [1 2 3])

((benchmark-fn foo-qualifier/baz-name) 55) ;; =&gt; 110
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/blosavio/fastester/blob/main/src/fastester/measure.clj#L659">view source</a></div></div><div class="public anchor" id="var-clear-registry.21"><h3>clear-registry!</h3><div class="usage"><code>(clear-registry!)</code></div><div class="doc"><div class="markdown"><p>Remove all entries from the benchmark <a href="fastester.measure.html#var-registry">registry</a>.</p>
</div></div><div class="src-link"><a href="https://github.com/blosavio/fastester/blob/main/src/fastester/measure.clj#L147">view source</a></div></div><div class="public anchor" id="var-defbench"><h3>defbench</h3><h4 class="type">macro</h4><div class="usage"><code>(defbench name group f n)</code></div><div class="doc"><div class="markdown"><p>Define a benchmark by adding a name, a group, a function, and arguments sequence to the  <a href="fastester.measure.html#var-registry">registry</a>.</p>
<ul>
<li><code>name</code> is a symbol that labels the benchmark. If supplied as a qualified symbol, <code>name</code> is used as-is. If supplied as a simple symbol, <code>name</code> is appended with <code>*ns*</code> when benchmark definition is added to the registry.</li>
<li><code>group</code> is a string, shared between multiple conceptually-related benchmarks.</li>
<li><code>f</code> is a 1-arity function that measures some performance aspect. Its single argument is the “n” in <em>big-O</em> notation. <code>f</code> may be supplied as an S-expression or a function object. Supplying <code>f</code> as an S-expression has the advantage that the definition may later convey some meaning, e.g., <code>(fn [n] (+ n n))</code>, in the html charts and tables, whereas a function object will render less meaningfully, e.g., <code>#function[fastester.measure/eval11540/fn--11541]</code>.</li>
<li><code>n</code> is a sequence of one or more arguments. During performance testing, elements of <code>n</code> will be individually supplied to the benchmarking utility.</li>
</ul>
<p>Example, supplying <code>f</code> as an S-expression:</p>
<pre><code class="language-clojure">(defbench add-two "benchmarking addition" (fn [n] (+ n n)) [1 10 100 1000])
</code></pre>
<p>Example, supplying <code>f</code> as a function object:</p>
<pre><code class="language-clojure">(defn my-fn-obj [q] (+ q q q))

(defbench add-three "benchmarking addition" my-fn-obj [2 20 200 2000])
</code></pre>
<p>Both examples above share the same <code>group</code> label (“benchmarking addition”), as both are concerned with measuring the performance of <code>+</code>. Putting them in the same group signifies that they are conceptually-related, and the html document will aggregate them under a single subsection. Also notice that the <code>n</code> sequences need not be identical.</p>
<p>Note: Invoking a <code>defbench</code> expression, editing the <code>name</code>, followed by invoking <code>defbench</code> a second time, defines two unique benchmarks. When developing at the REPL, be aware that the registry may become ‘stale’ with outdated tests.</p>
<ol>
<li>To remove a single, unwanted test, use <a href="fastester.measure.html#var-undefbench">undefbench</a>.</li>
<li>To put the registry into a state that reflects only the current definitions, use <a href="fastester.measure.html#var-clear-registry.21">clear-registry!</a> and re-evaluate the namespace to invoke all the current <code>defbench</code>s .</li>
</ol>
<p>See <a href="fastester.measure.html#var-defbench*">defbench*</a> for the function version.</p>
</div></div><div class="src-link"><a href="https://github.com/blosavio/fastester/blob/main/src/fastester/measure.clj#L188">view source</a></div></div><div class="public anchor" id="var-defbench*"><h3>defbench*</h3><div class="usage"><code>(defbench* benchmark-name group f n)</code></div><div class="doc"><div class="markdown"><p>Function version of <code>defbench</code> macro. Define and register a benchmark. See <a href="fastester.measure.html#var-defbench">defbench</a> documentation for full details. The two differences are that <code>benchmark-name</code> and <code>f</code> are supplied as a quoted symbols.</p>
<p>Example:</p>
<pre><code class="language-clojure">(defbench* 'add-four "benchmarking addition" '(fn [z] (+ z z z z) [1 10 100])
</code></pre>
<p>If <code>benchmark-name</code> is a qualified symbol, it is used as-is. If <code>benchmark-name</code> is a simple symbol, it is prepended with <code>*ns*</code> when benchmark definition is added to the registry.</p>
</div></div><div class="src-link"><a href="https://github.com/blosavio/fastester/blob/main/src/fastester/measure.clj#L154">view source</a></div></div><div class="public anchor" id="var-range-pow-10"><h3>range-pow-10</h3><div class="usage"><code>(range-pow-10 i)</code></div><div class="doc"><div class="markdown"><p>Given integer <code>i</code>, returns a sequence of <code>[10^0...10^i]</code>, inclusive. Useful for supplying to benchmarking functions.</p>
<p>Examples:</p>
<pre><code class="language-clojure">(range-pow-10 3) ;; =&gt; (1 10 100 1000)
(range-pow-10 6) ;; =&gt; (1 10 100 1000 10000 100000 1000000)
</code></pre>
<p>See also <a href="fastester.measure.html#var-range-pow-2">range-pow-2</a>.</p>
</div></div><div class="src-link"><a href="https://github.com/blosavio/fastester/blob/main/src/fastester/measure.clj#L572">view source</a></div></div><div class="public anchor" id="var-range-pow-2"><h3>range-pow-2</h3><div class="usage"><code>(range-pow-2 i)</code></div><div class="doc"><div class="markdown"><p>Given integer <code>i</code>, returns a sequence of <code>[2^0...2^i]</code>, inclusive. Useful for supplying to benchmarking functions.</p>
<p>Example:</p>
<pre><code class="language-clojure">(range-pow-2 8) ;; (1 2 4 8 16 32 64 128 256)
</code></pre>
<p>See also <a href="fastester.measure.html#var-range-pow-10">range-pow-10</a>.</p>
</div></div><div class="src-link"><a href="https://github.com/blosavio/fastester/blob/main/src/fastester/measure.clj#L588">view source</a></div></div><div class="public anchor" id="var-registry"><h3>registry</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>An atom containing a hashmap of benchmarks to run. Typically populated by invoking <a href="fastester.measure.html#var-defbench">defbench</a> or <a href="fastester.measure.html#var-defbench*">defbench*</a>, not manipulated directly.</p>
<p>See also <a href="fastester.measure.html#var-undefbench">undefbench</a> and <a href="fastester.measure.html#var-clear-registry.21">clear-registry!</a>.</p>
</div></div><div class="src-link"><a href="https://github.com/blosavio/fastester/blob/main/src/fastester/measure.clj#L143">view source</a></div></div><div class="public anchor" id="var-run-benchmarks"><h3>run-benchmarks</h3><div class="usage"><code>(run-benchmarks)</code><code>(run-benchmarks explicit-options-filename)</code></div><div class="doc"><div class="markdown"><p>Execute benchmarks associated to option key <code>:benchmarks</code>, saving results to a version-specific directory. If <code>explicit-options-filename</code> is not supplied, defaults to <code>./resources/fastester_options.edn</code>.</p>
<p>If option <code>:parallel?</code> is <code>true</code>, runs tests in parallel. Warning: Running tests in parallel results in inconsistent time measurements. Use <code>:parallel? true</code> only for sanity-checking the return values of <code>(f n)</code>, not for final performance measurements.</p>
</div></div><div class="src-link"><a href="https://github.com/blosavio/fastester/blob/main/src/fastester/measure.clj#L510">view source</a></div></div><div class="public anchor" id="var-run-manual-benchmark"><h3>run-manual-benchmark</h3><h4 class="type">macro</h4><div class="usage"><code>(run-manual-benchmark fexpr arg thoroughness)</code></div><div class="doc"><div class="markdown"><p>Given 1-arity, S-expression <code>fexpr</code> representing a function and one argument <code>arg</code>, run one benchmark test using keyword <code>thoroughness</code> to designate the Criterium options, sending result to *<code>out</code>*.</p>
<p><code>thoroughness</code> is one of <code>:default</code>, <code>:quick</code>, or <code>:lightning</code>.</p>
<p>Example:</p>
<pre><code class="language-clojure">(run-manual-benchmark (fn [n] (+ n n)) 9 :lightning)
</code></pre>
<p>See <a href="fastester.measure.html#var-run-one-defined-benchmark">run-one-defined-benchmark</a> and <a href="fastester.measure.html#var-*lightning-benchmark-opts*">*lightning-benchmark-opts*</a>.</p>
</div></div><div class="src-link"><a href="https://github.com/blosavio/fastester/blob/main/src/fastester/measure.clj#L349">view source</a></div></div><div class="public anchor" id="var-run-one-defined-benchmark"><h3>run-one-defined-benchmark</h3><h4 class="type">macro</h4><div class="usage"><code>(run-one-defined-benchmark benchmark-name thoroughness)</code></div><div class="doc"><div class="markdown"><p>Given defined <code>benchmark</code>, an unquoted symbol, and keyword <code>thoroughness</code> that designates the Criterium options, runs a benchmark for each defined argument. Returns a hashmap whose keys are arguments <code>n</code>, associated to values that are the benchmark results for that <code>n</code>.</p>
<p><code>thoroughness</code> is one of <code>:default</code>, <code>:quick</code>, or <code>:lightning</code>.</p>
<p>Example:</p>
<pre><code class="language-clojure">(defbench my-qualifier/my-bench "my-group" (fn [x] (inc x)) [97 98 99])

(run-one-defined-benchmark my-qualifier/my-bench :lightning)
</code></pre>
<p>Returns a hashmap with three key+vals: keys <code>97</code>, <code>98</code>, and <code>99</code>, each associated with its respective benchmark result.</p>
<p>See also <a href="fastester.measure.html#var-run-manual-benchmark">run-manual-benchmark</a> and <a href="fastester.measure.html#var-*lightning-benchmark-opts*">*lightning-benchmark-opts*</a>.</p>
</div></div><div class="src-link"><a href="https://github.com/blosavio/fastester/blob/main/src/fastester/measure.clj#L699">view source</a></div></div><div class="public anchor" id="var-run-one-defined-benchmark*"><h3>run-one-defined-benchmark*</h3><div class="usage"><code>(run-one-defined-benchmark* benchmark-name thoroughness)</code></div><div class="doc"><div class="markdown"><p>Function version of <a href="fastester.measure.html#var-run-one-defined-benchmark">run-one-defined-benchmark</a>.</p>
<p><code>benchmark</code> is a quoted symbol. <code>thoroughness</code> is a keyword that designates the Criterium options, one of <code>:default</code>, <code>:quick</code>, or <code>:lightning</code>.</p>
<p>Example:</p>
<pre><code class="language-clojure">(defbench* 'my-qualifier/my-bench "my-group" '(fn [x] (inc x)) [97 98 99])

(run-one-defined-benchmark* my-qualifier/my-bench :lightning)
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/blosavio/fastester/blob/main/src/fastester/measure.clj#L674">view source</a></div></div><div class="public anchor" id="var-run-save-benchmark"><h3>run-save-benchmark</h3><div class="usage"><code>(run-save-benchmark ver name namespace group f fexpr arg idx opts)</code></div><div class="doc"><div class="markdown"><p>Given string <code>ver</code>, symbol <code>name</code>, namespace <code>namespace</code>, string <code>group</code>, function object <code>f</code>, function S-expression <code>fexpr</code>, test argument <code>arg</code>, option hashmap <code>opts</code>, and index integer <code>idx</code>, measures the evaluation time under the current Criterium benchmark settings and saves results to file system.</p>
<p>Example:</p>
<pre><code class="language-clojure">(run-save-benchmark "77-SNAPSHOT7"
                    'mult-two-nums
                    'benchmark-namespace
                    "adding --- stuff"
                    (fn [n] (* n n))
                    '(fn [n] (* n n))
                    22
                    5
                    options)
</code></pre>
<p>See also <a href="fastester.measure.html#var-run-manual-benchmark">run-manual-benchmark</a> and <a href="fastester.measure.html#var-run-one-defined-benchmark">run-one-defined-benchmark</a> for utilities to quickly benchmark an expression.</p>
</div></div><div class="src-link"><a href="https://github.com/blosavio/fastester/blob/main/src/fastester/measure.clj#L414">view source</a></div></div><div class="public anchor" id="var-undefbench"><h3>undefbench</h3><h4 class="type">macro</h4><div class="usage"><code>(undefbench benchmark-name)</code></div><div class="doc"><div class="markdown"><p>Undefine a benchmark by removing <code>benchmark-name</code> from the <a href="fastester.measure.html#var-registry">registry</a>.</p>
<p>Example:</p>
<pre><code class="language-clojure">;; define a performance test
(defbench add-two "benchmarking addition" (fn [n] (+ n n)) [1 10 100 1000])

;; undefine that performance test
(undefbench add-two)
</code></pre>
<p>If <code>benchmark-name</code> is a qualified symbol, it is used as-is. If <code>benchmark-name</code> is a simple symbol, there must be only one qualified name in the registry with that simple part, otherwise an exception is thrown.</p>
<p>Undoes the results of <a href="fastester.measure.html#var-defbench">defbench</a>. See also <a href="fastester.measure.html#var-undefbench*">undefbench*</a>.</p>
</div></div><div class="src-link"><a href="https://github.com/blosavio/fastester/blob/main/src/fastester/measure.clj#L273">view source</a></div></div><div class="public anchor" id="var-undefbench*"><h3>undefbench*</h3><div class="usage"><code>(undefbench* benchmark-name)</code></div><div class="doc"><div class="markdown"><p>Function version of <a href="fastester.measure.html#var-undefbench">undefbench</a>. Undefines a benchmark by removing quoted symbol <code>name</code> from the <a href="fastester.measure.html#var-registry">registry</a>.</p>
<p>Example:</p>
<pre><code class="language-clojure">;; define a performance test
(defbench* 'add-four "benchmarking addition" '(fn [z] (+ z z z z) [1 10 100])

;; undefine that performance test
(undefbench* 'add-four)
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/blosavio/fastester/blob/main/src/fastester/measure.clj#L242">view source</a></div></div></div></body></html>